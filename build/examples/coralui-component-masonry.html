<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Coral.Masonry</title>
    <link rel="stylesheet" href="../css/coral.css">
    <script src="../js/coral.js"></script>
    <style>
    body {
      padding: 15px;
    }

    .coral3-Masonry {
      border: 1px dashed #ccc;
      border-radius: 4px;
      margin: 1rem;
      padding: 0.5rem;
    }

    .coral3-Masonry.is-complete > .coral3-Masonry-item.is-beforeInserting:first-child {
      /* Set top to padding height for a straight transition */
      transform: translate(-200%, 0.5rem);
    }

    .coral3-Masonry-item {
      margin: 0.5rem;
    }

    .coral3-Masonry article {
      padding: 0.5rem;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }

    .coral3-Masonry img {
      max-width: 100%;
    }

    [coral-masonry-draghandle]:before {
      content: "â ¿";
    }

    </style>
  </head>

  <body class="coral--light">

    <div style="position:fixed;top:15px;right:15px;">
      <a href="#" class="coral-Link" onclick="event.preventDefault();document.body.className='coral--light'">Light</a> |
      <a href="#" class="coral-Link" onclick="event.preventDefault();document.body.className='coral--lightest'">Lightest</a> |
      <a href="#" class="coral-Link" onclick="event.preventDefault();document.body.className='coral--dark'">Dark</a> |
      <a href="#" class="coral-Link" onclick="event.preventDefault();document.body.className='coral--darkest'">Darkest</a>
    </div>

    <h1 class="coral-Heading coral-Heading--1">Coral.Masonry</h1>

    <label>
      <input type="checkbox" id="is-selectable">
      Selectable items
    </label>
    <br>
    <label>
      Layout
      <select name="layout">
        <option>fixed-centered</option>
        <option>fixed-spread</option>
        <option>variable</option>
        <option>dashboard</option>
      </select>
    </label>
    <br>
    <label>
      Column width
      <input name="columnWidth">
    </label>
    <br>
    <button class="prepend" data-count="1">prepend 1</button>
    <button class="prepend" data-count="10">prepend 10</button>
    <button class="append" data-count="1">append 1</button>
    <button class="append" data-count="10">append 10</button>
    <button class="append" data-count="100">append 100</button>
    <label>
      Image
      <input type="checkbox" name="image">
    </label>
    (double click on item to remove it)

    <coral-masonry orderable id="masonry" layout="fixed-centered" columnwidth="250" orderable>
      <coral-masonry-item class="coral-Well">
        <article>
          <span coral-masonry-draghandle></span>
          With image
          <img src="http://via.placeholder.com/600x300">
        </article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>
          <span coral-masonry-draghandle></span>
          card
          <br>card
        </article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well" colspan="2">
        <article>
          <span coral-masonry-draghandle></span>
          card
          <br>card
          <br>card
        </article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>
          <span coral-masonry-draghandle></span>
          card
          <br>card
          <br>card
          <br>card
        </article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well" colspan="2">
        <article>card
          <br>card
          <br>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>card
          <br>card
          <br>card
          <br>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well" colspan="2">
        <article>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>card
          <br>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well" colspan="2">
        <article>card
          <br>card
          <br>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
      <coral-masonry-item class="coral-Well">
        <article>card
          <br>card
          <br>card
          <br>card
          <br>card
          <br>card</article>
      </coral-masonry-item>
    </coral-masonry>
    <script>
    const masonry = document.getElementById('masonry');

    const layoutSelector = document.querySelector('[name=layout]');
    layoutSelector.value = masonry.getAttribute('layout');
    layoutSelector.addEventListener('change', function() {
      masonry.setAttribute('layout', this.value);
    });

    const columnWidthSelector = document.querySelector('[name=columnWidth]');
    columnWidthSelector.value = masonry.getAttribute('columnwidth');
    columnWidthSelector.addEventListener('input', function() {
      masonry.setAttribute('columnwidth', this.value);
    });

    masonry.on('dblclick', 'coral-masonry-item', function(event) {
      event.matchedTarget.remove();
    });

    Coral.events.on('click', '.prepend', function() {
      var count = this.dataset.count;
      for (var i = 0; i < count; i++) {
        masonry.items.add(createItem(), masonry.items.first());
      }
    });

    Coral.events.on('click', 'coral-masonry-item', function(event) {
      if (masonry.classList.contains('is-selectable')) {
        event.matchedTarget.selected = !event.matchedTarget.selected;
      }
    });

    Coral.events.on('click', '.append', function() {
      var startTime = Date.now();
      var count = this.dataset.count;
      for (var i = 0; i < count; i++) {
        masonry.items.add(createItem());
      }
      window.requestAnimationFrame(function() {
        console.log('Appending time:', Date.now() - startTime);
      });
    });

    Coral.events.on('change', '#is-selectable', function(event) {
      masonry.classList.toggle('is-selectable', event.target.checked);
    });

    function createItem() {
      var image = document.querySelector('[name=image]').checked;
      return image ? createImageItem() : createTextItem();
    }

    function randomSize() {
      return (2 + Math.round(Math.random() * 4)) * 100;
    }

    function createImageItem() {
      var width = randomSize();
      var height = randomSize();
      var url = 'http://via.placeholder.com/' + width + 'x' + height;

      var item = document.createElement('coral-masonry-item');
      item.classList.add('coral-Well');
      item.content.innerHTML = '<img src="' + url + '" style="width: ' + (width / 2) + 'px; height: ' + (height / 2) + 'px;">';

      return item;
    }

    function createTextItem() {
      var rows = 1 + Math.round(Math.random() * 6);
      var html = new Array(rows + 1).join('card<br>').slice(0, -4);

      var item = document.createElement('coral-masonry-item');
      item.classList.add('coral-Well');
      item.content.innerHTML = '<article>' + html + '</article>';

      return item;
    }
    </script>
  </body>

</html>
