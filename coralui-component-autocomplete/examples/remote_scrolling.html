<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Autocomplete</title>

  <link rel="stylesheet" href="../build/css/coral.css">
  <script src="../build/js/coral.js"></script>
  <script>
    // Mocked server interaction
    (function() {
      // "Send" a "request"
      window.fakejax = function(url, data, callback) {
        var requestTimeout = setTimeout(function() {
          // Filter the suggestions according to the user input
          // This would run on the server, effectively
          var suggestions = [];

          for (var i = 0; i < 5; i++) {
            var number = i + data.start;
            suggestions.push({
              value: number,
              content: 'Item '+number
            });
          }

          callback(suggestions);
        }, 500);

        return {
          abort: function() {
            // Stop previous request
            clearTimeout(requestTimeout);
          }
        };
      }
    }());
  </script>
</head>
<body class="coral--light">
  <h1 class="coral-Heading coral-Heading--1">Remote Data</h1>

  <form id="form" action="/formtest">
    <label id="browserLabel">Browser</label>
    <coral-autocomplete id="autocomplete" icon="search" name="browser" delay="50" labelledby="browserLabel" multiple></coral-autocomplete>

    <button is="coral-button" type="submit">Submit</button>
  </form>

  <script>
    window.requestAnimationFrame(function() {
      var autocomplete = document.querySelector('#autocomplete');

      var request;
      autocomplete.on('coral-autocomplete:showsuggestions', function(event) {
        // If a previous request was started, abort it
        if (request) {
          request.abort();
        }

        // Don't show suggestions from existing items
        // This shows a loading icon until we call addSuggestions
        event.preventDefault();

        // Get the user input as lowercase
        var userInput = event.detail.value.toLowerCase();
        var startRecord = event.detail.start;

        // Make a request and show the resulting suggestions
        request = fakejax('/api/suggestions', { query: userInput, start: startRecord }, function(suggestions) {
          autocomplete.addSuggestions(suggestions);
        });
      });

      autocomplete.on('coral-autocomplete:hidesuggestions', function() {
        // If the suggestions were hidden, abort the request
        if (request) {
          request.abort();
        }
      });
    });
  </script>
</body>
</html>
