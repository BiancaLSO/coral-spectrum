<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Coral3 | Coral.Tree</title>

  <link rel="stylesheet" href="../build/css/coral.css">
  <script src="../build/js/coral.js"></script>

  <style>
    .col {
      width: 48%;
      margin-right: 1%;
      display: inline-block;
      vertical-align: top;
    }
    nav {
        margin: 1rem;
    }
    #treeLog{
        width: 100%;
        height: 26rem;
    }
    section {
      padding: 12px;
    }
  </style>
</head>
<script>
    var tree = null;
    var treeLog = null;
    var itemName = null;
    function onLoad(){
        tree = document.querySelector("#tree");
        treeLog = document.querySelector("#treeLog");
        itemName =  document.querySelector(".itemName");

        tree.addEventListener('coral-tree:change', function(event) {
            var selectedItem = getSelectedItem();
            document.querySelector(".selectedItemAction").attr("disabled", selectedItem ? false : true);
            var value = selectedItem ? selectedItem.value : null;
            logMessage('Selection change : selected item -> (' + selectedItem+"), value -> ("+value+")");
        });

        tree.addEventListener('coral-collection:add', function(event) {
            logMessage('Added new item  -> (' + event.detail.item+"'), value -> (" + event.detail.item.value+")");
        });
        tree.addEventListener('coral-collection:remove', function(event) {
            logMessage('Removed item -> (' + event.detail.item+"'), value -> (" + event.detail.item.value+")");
        });

      document.querySelector(".selectedItemAction").attr("disabled",true);
    }
    function getSelectedItem(){
        return tree ? tree.selectedItem : null;
    }

    function logMessage(message){
        treeLog.value += "\n" + message;
    }
    function addNewItem(){
        var selectedItem = getSelectedItem();
        if(!selectedItem) // if no items is selected then add at root
            selectedItem = tree;
        selectedItem.items.add({ value: itemName.value , content: { innerHTML: itemName.value} })
    }
    function deleteSelectedItem(){
        var selectedItem = getSelectedItem();
        var items = null;
        if(selectedItem) {
            if(selectedItem.parent)
                items = selectedItem.parent.items;
            else
                items = selectedItem.parentElement.items; // Selected item is root element
            if(items)
                items.remove(selectedItem);

        }
    }
    function expandCollapseSelectedItem(){
        var selectedItem = getSelectedItem();
        if(selectedItem)
            selectedItem.expanded = !selectedItem.expanded;
    }

    function selectFirstItem(){
        if(tree && tree.items){
           var firstItem = tree.items.getFirstSelectable();
            if(firstItem){
                firstItem.selected = true;
            }
        }
    }
    function selectLastItem(){
        if(tree && tree.items){
            var firstItem = tree.items.getLastSelectable();
            if(firstItem){
                firstItem.selected = true;
            }
        }
    }
    function selectNextItem(){
        var selectedItem = getSelectedItem();
        if(selectedItem){
            var nextItem = tree.items.getNextSelectable(selectedItem);
            if(nextItem){
                nextItem.selected = true; // select next item;
                if(nextItem.parent)
                    nextItem.parent.expanded = true; // make sure parent is expanded
            }
        }
    }
    function selectPreviousItem(){
        var selectedItem = getSelectedItem();
        if(selectedItem){
            var previousItem = tree.items.getPreviousSelectable(selectedItem);
            if(previousItem){
                previousItem.selected = true; // select next item;
                if(previousItem.parent)
                    previousItem.parent.expanded = true; // make sure parent is expanded
            }
        }
    }


</script>
<body class="coral--light" onload="onLoad()">

<section>
    <div class="col">
        <h2>Coral Tree</h2>
        <nav>
            <h3>Top level actions</h3>
            <label><input type="checkbox" onchange="tree.multiple = this.checked"> Multi-selection</label>
            <br />

            <button is="coral-button" onclick="tree.expandAll()">Expand All</button>
            <button is="coral-button" onclick="tree.collapseAll()">Collapse All</button>
            <button is="coral-button" onclick="selectFirstItem()">Select First Item</button>
            <button is="coral-button" onclick="selectNextItem()" class="selectedItemAction">Select Next Item</button>
            <button is="coral-button" onclick="selectPreviousItem()" class="selectedItemAction">Select Previous Item</button>
            <button is="coral-button" onclick="selectLastItem()">Select Last Item</button>

            <h3>Following action works on selectedItem</h3>
            <div class="coral-Form-field coral-DecoratedTextfield">
              <input type="text" class="itemName coral-DecoratedTextfield-input coral-Textfield" placeholder="Item name">
              <button is="coral-button" icon="add" class="coral-DecoratedTextfield-button" onclick="addNewItem()"></button>
            </div>
            <button is="coral-button" icon="delete" class="selectedItemAction" onclick="deleteSelectedItem()">Delete Selected Item</button>
            <button is="coral-button" icon="add" class="selectedItemAction" onclick="expandCollapseSelectedItem()">Expand/Collapse Selected Item</button>
        </nav>
        <coral-tree id="tree">
            <coral-tree-item>
              <coral-tree-item-content>Item 1</coral-tree-item-content>
              <coral-tree-item><coral-tree-item-content>Sub Item 1</coral-tree-item-content></coral-tree-item>
              <coral-tree-item><coral-tree-item-content>Sub Item 2</coral-tree-item-content></coral-tree-item>
            </coral-tree-item>
            <coral-tree-item><coral-tree-item-content>Item 2</coral-tree-item-content></coral-tree-item>
            <coral-tree-item><coral-tree-item-content>Item 3</coral-tree-item-content></coral-tree-item>
        </coral-tree>
    </div>
    <div class="col">
        <h2>Log</h2>
        <button is="coral-button" onclick="treeLog.value = ''">Clear</button>
        <textarea id="treeLog" readonly="true" class="coral-Textfield coral-Textfield--multiline docs-Example-log"></textarea>
    </div>
</section>
</body>
</html>
