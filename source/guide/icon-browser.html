<!DOCTYPE html>
<html>

<head>
  <title>Icon Browser</title>

  <meta charset="utf-8">

  <link rel="stylesheet" href="css/cui.css">
  <link rel="stylesheet" href="css/guide.css">
  <link rel="stylesheet" href="js/google-code-prettify/prettify.css">

  <!-- Dependencies -->
  <script src="js/libs/handlebars.full.js"></script>
  <script src="js/libs/jquery.js"></script>
  <script src="js/libs/jquery-fingerpointer.js"></script>
  <script src="js/libs/toe.js"></script>

  
  <script src="js/google-code-prettify/prettify.js"></script>

  <!-- CoralUI -->
  <script src="js/CUI.js"></script>

  <script>
  
    function encodeEntities(str) {
      return str.replace(/[<>"&]/g, function(input) {
        var output = '&';
        if (input === '<')
          output += 'lt';
        if (input === '>')
          output += 'gt';
        if (input === '"')
          output += 'quot';
        if (input === '&')
          output += 'amp';
        output += ';';
        return output;
      });
    }
  
    CUI.IconBrowser = new Class({
      Templates: {
        TableRow: Handlebars.compile([
          '<tr><td><i class="{{selector}} medium"></i></td><td>{{name}}</td><td>{{selector}}</td></tr>'
        ].join('\n'))
      },
      
      construct: function(options) {
        this.$searchField = $('#searchField');
        this.$tbody = $('#iconTable tbody');
        
        var that = this;
        
        // Fetch the icons
        this.fetchIcons(this.createTable.bind(this));
        
        // Stores icon whose details are being viewed
        this.currentIcon = null;
        
        // Show details
        this.$tbody.on('click', 'tr', function(evt) {
          var $target = $(evt.currentTarget);
          var icon = $target.data('icon');
          
          that.showDetails(icon);
        });
        
        // Search
        this.$searchField.on("keyup paste cut", function(data) {
          that.filter(that.$searchField.val());
        });
        
        // Adjust sample
        $('#iconDetails').on('change', 'input[type="range"]', function(evt) {
          this.sample.size = evt.currentTarget.value;
          this.updateSample();
        }.bind(this));
        
        $('#iconDetails').on('change', 'input[name="iconColor"]', function(evt) {
          this.sample.color = evt.currentTarget.value;
          this.updateSample();
        }.bind(this));
        
        $('#iconDetails').on('change', 'input[name="buttonType"]', function(evt) {
          this.sample.buttonType = evt.currentTarget.value;
          this.updateSample();
        }.bind(this));
        
        $('#iconDetails').on('change', 'input[name="iconUsage"]', function(evt) {
          this.sample.usage = evt.currentTarget.value;
          
          if (this.sample.usage === 'button') {
            $('#iconLabel').prop('checked', true).attr('disabled', true);
            $('#buttonTypeBox').show();
            
            $('#iconSizeSlider').slider({
              disabled: true,
              value: 2
            });
          }
          else {
            $('#iconLabel').prop('checked', this.sample.withLabel).attr('disabled', false);
            $('#buttonTypeBox').hide();
            
            $('#iconSizeSlider').slider({
              disabled: false
            });
          }
          
          this.updateSample();
        }.bind(this));
        
        $('#iconDetails').on('keyup change', 'input[name="iconLabelText"]', function(evt) {
          this.sample.labelText = evt.currentTarget.value;
          this.updateSample();
        }.bind(this));
        
        $('#iconDetails').on('change', 'input[name="iconLabel"]', function(evt) {
          this.sample.withLabel = evt.currentTarget.checked;
          this.updateSample();
        }.bind(this));
      },
      
      sizeMap: {
        1: 'xsmall',
        2: 'small',
        3: 'medium',
        4: 'large'
      },
      
      sample: {
        size: 2,
        color: 'light',
        withLabel: false,
        labelText: '',
        usage: 'illustrative',
        buttonType: 'standard'
      },
      
      updateSample: function() {
        if (this.sample.color == 'dark')
          $('#iconSampleBox').addClass('dark');
        else
          $('#iconSampleBox').removeClass('dark');
        
        var icon = this.currentIcon;
        var size = this.sizeMap[this.sample.size];
        var withLabel = this.sample.withLabel;
        var label = this.sample.labelText;
        var color = this.sample.color === 'dark' ? 'white' : 'black';
        var tag = 'i';
        if (this.sample.usage === 'link')
          tag = 'a';
        else if (this.sample.usage === 'action')
          tag = 'button';
        
        // Create code
        var html = '';
        
        if (this.sample.usage === 'button') {
          html += '<button';
          
          if (this.sample.buttonType !== 'standard')
            html +=' class="'+this.sample.buttonType+'"';

          html += '>';
        }
        
        html += '<'+tag;
        
        if (tag === 'a')
          html += ' href="#"';
          
        html += ' class="'+icon.selector;
        
        html += ' '+size;
        
        if (this.sample.usage !== 'button' && withLabel)
          html += ' withLabel';
        
        if (this.sample.usage !== 'button' && color == 'white')
          html += ' white';
          
        html += '"';
        
        html += '>';
        
        if (this.sample.usage !== 'button')
          html += label;
        
        html += '</'+tag+'>';
        
        if (this.sample.usage === 'button')
          html += label+'</button>';
          
        $('#iconSampleBox').html(html);
        
        // Add code sample
        $('#iconCode').html(encodeEntities(html));
        prettyPrint();
        
        // Make sure slider exists
        $('#iconSizeSlider').slider();
      },
      
      showDetails: function(icon) {
        console.log('Show details for '+icon.file);
        
        var previousIcon = this.currentIcon;
        if (previousIcon)
          previousIcon.$tr.removeClass('selected');
        
        icon.$tr.addClass('selected');
        
        // Populate details
        $('#iconDetailsHelperText').hide();
        $('#iconDetails').show();

        // Add details
        $('#iconName').html(icon.name);
        $('#iconLabelText').val(icon.name);
        
        this.sample.labelText = icon.name;
        
        this.currentIcon = icon;
        
        this.updateSample();
      },
      
      fetchIcons: function(callback) {
        var that = this;
        $.getJSON('examples/assets/iconbrowser.json', function(icons) {
           // Store icons
           that.icons = icons;
           
           if (typeof callback === 'function')
              callback(icons);
        });
      },
      
      createTable: function(icons) {
        // Show all icons by default
        if (!icons)
          icons = this.icons;
          
        var doc = document;

        this.$tbody.html('');

        // Use a fragment to avoid reflow
        var fragment = doc.createDocumentFragment();

        var template = this.Templates.TableRow;

        $(icons).each(function (i, icon) {
          // Create a row
          var tr = doc.createElement("tr");
          
          // Store name without extension
          icon.name = icon.file.slice(0, icon.file.indexOf('.svg'))
          
          var $tr = $(template(icon));
          
          // Store reference to table row
          icon.$tr = $tr;
          
          // Store reference to the icon data
          $tr.data('icon', icon);
          
          // Add to fragment
          fragment.appendChild($tr[0]);
        });        

        // Add the fragment to the table
        this.$tbody.append(fragment);
      },
      
      showAll: function() {
        for (var i = this.icons.length - 1; i >= 0; i--) {
          this.icons[i].$tr.hide();
        }
      },
      
      filter: function(searchString) {
        var result = [];
        if (searchString) {
          var terms = searchString.split(" ");
          for (var i = this.icons.length - 1; i >= 0; i--) {
            var icon = this.icons[i];

            if (this.matchIcon(icon, terms))
              icon.$tr.show();
            else
              icon.$tr.hide();
          }
        }
        else
          this.showAll();
      },
      
      matchIcon: function(icon, terms)  {
        var result = false;
        if (icon) {
          for (var i = terms.length - 1; i >= 0; i--) {
            var term = terms[i];
            if (icon.selector.indexOf(term) != -1 || icon.file.indexOf(term) != -1) {
              result = true;
            }
            else {
              result = false;
              break;
            }
          }  
        }
        return result;
      }
    });

    var iconBrowser;
    $(document).ready(function() {
      iconBrowser = new CUI.IconBrowser();
    });
</script>
</head>

<body>

  <header class="top">

      <div class="logo"><img src="images/theme/cloudui.png" alt="CoralUI logo"></div>

      <nav class="main">
          <a href="#" class="selected">Icon Browser</a>
      </nav>

  </header>

  <div class="page" role="main">

    <div class="rail light right iconDetailRail">
      <div class="wrap">
        <section id="iconDetailsHelperText">
          <p class="smallText">Select an icon for details.</p>
        </section>
        
        <div id="iconDetails" style="display: none;">
          <section>
            <h3 id="iconName"></h3>
            <p id="iconDescription">Description here</p>
          </section>

          <section>
            <h5>Size</h5>
            <div class="slider ticked" id="iconSizeSlider">
                <input type="range" name="iconSize" value="2" min="1" max="4" step="1">
            </div>

            <h5>Label/Accessibility Text</h5>
            <input type="text" name="iconLabelText" class="iconLabelText" id="iconLabelText">
            <label><input type="checkbox" name="iconLabel" id="iconLabel" value="1"><span></span> Show label</label><br>

            <div class="left">
              <h5>Usage</h5>
              <label><input type="radio" name="iconUsage" value="illustrative" checked><span></span> Illustrative</label><br>
              <label><input type="radio" name="iconUsage" value="link"><span></span> Link</label><br>
              <label><input type="radio" name="iconUsage" value="action"><span></span> Action</label><br>
              <label><input type="radio" name="iconUsage" value="button"><span></span> Button</label>
            </div>

            <div class="left iconUIColorBox">
              <h5>UI Color</h5>
              <label><input type="radio" name="iconColor" value="light" checked><span></span> Light</label><br>
              <label><input type="radio" name="iconColor" value="dark"><span></span> Dark</label>
            </div>

            <div class="left iconUIColorBox" id="buttonTypeBox" style="display: none;">
              <h5>Button Type</h5>
              <label><input type="radio" name="buttonType" value="standard" checked><span></span> Standard</label><br>
              <label><input type="radio" name="buttonType" value="primary"><span></span> Primary</label><br>
              <label><input type="radio" name="buttonType" value="warning"><span></span> Warning</label><br>
            </div>

            <div class="clear"></div>

          </section>

          <section>
            <h4>Sample</h4>

            <div class="iconBoxContainer">
              <div class="iconBox" id="iconSampleBox">
              </div>
            </div>

            <h4>HTML</h4>

            <code class="prettyprint" id="iconCode"></code>
          </section>
        </div>
      </div>
    </div>
    <div class="content">
      <div class="contentContainer">
        <div class="search">
          <input id="searchField" class="search-input" type="text" placeholder="Search">
          <button type="button">
        </div>

        <table id="iconTable" class="data">
          <thead>
            <tr>
              <th>Icon</th>
              <th>Name</th>
              <th>Selector</th>
            </tr>
          </thead>

          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</body>
</html>
