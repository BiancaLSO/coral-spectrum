<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CoralUI 3 Shell</title>
  <link rel="stylesheet" href="../build/css/coral.css">
  <script src="../build/js/coral.js"></script>
</head>
<body class="coral--light">

  <coral-shell-help id="help">
    <a is="coral-shell-help-item" icon="globe" href="/learn">Marketing Cloud Help</a>
    <a is="coral-shell-help-item" icon="users" href="/community">Community</a>
    <a is="coral-shell-help-item" icon="callCenter" href="/customercare">Customer Care</a>
    <a is="coral-shell-help-item" icon="news" href="/news">What's new in CoralUI</a>
    <a is="coral-shell-help-item" icon="servers" href="/status">Adobe Marketing Cloud Status</a>
    <a is="coral-shell-help-item" icon="lightbulb" href="/getstarted">Getting Started with CoralUI</a>
  </coral-shell-help>

  <script>
    // Get the API endpoint based on locale
    function getHelpAPIEndpoint() {
      // @todo i18n locale
      switch(Coral.locale) {
      case 'de_DE':
        return 'https://sp10050568.guided.ss-omtrdc.net/';
      case 'es_ES':
        return 'https://sp10050569.guided.ss-omtrdc.net/';
      case 'fr_FR':
        return 'https://sp1005056a.guided.ss-omtrdc.net/';
      case 'ja_JP':
        return 'https://sp1005056d.guided.ss-omtrdc.net/';
      case 'ko_KR':
        return 'https://sp1005056e.guided.ss-omtrdc.net/';
      case 'pt_BR':
        return 'https://sp1005056b.guided.ss-omtrdc.net/';
      case 'zh_CN':
        return 'https://sp1005056f.guided.ss-omtrdc.net/';
      case 'zh_TW':
        return 'https://sp1004f0bc.guided.ss-omtrdc.net/';
      default: // en_US
        return 'https://sp1004ced0.guided.ss-omtrdc.net/';
      }
    }

    function jsonp(url, callback, onError) {
      var callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
      window[callbackName] = function(data) {
        delete window[callbackName];
        document.body.removeChild(script);
        callback(data);
      };

      var script = document.createElement('script');
      script.src = url + (url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName;
      document.body.appendChild(script);

      script.onerror = onError;
    }

    // For all results (with a q param)
    var helpSiteURL = 'https://marketing.adobe.com/resources/help/en_US/home/';

    // Get a reference to the component
    var help = document.getElementById('help');

    // Listen for search requests
    help.on('coral-shell-help:search', function(event) {
      // Get the search term from the event detail
      var searchTerm = event.detail.value;

      // Request results
      jsonp(getHelpAPIEndpoint() + '?tmpl=help&q=' + searchTerm, function(response) {
        var results = response.results;

        // Populate results
        var resultItems = results.map(function(result) {
          return {
            tags: result.t0.split(/,\s*/),
            title: result.title,
            href: result.href,
            target: '_blank'
          };
        });

        // Show total
        var total = parseInt(response.resultcount.total, 10);
        help.showResults(resultItems, total, helpSiteURL+'?q='+encodeURIComponent(searchTerm));
      }, function() {
        help.showError();
      });
    });
  </script>

</body>
</html>
